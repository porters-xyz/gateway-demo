# Postgres Schema

## Description

It is the contract layer between the gateway and the portal. Any change to the schema must be coordinated between the portal and the gateway. It is a shared component between the portal and the gateway, as such connecting the two components.

Schemas are managed by **Prisma object relational model (ORM)**. It allows to generate object models for the schemas.

## Functionality

The schema consists of several tables. Tables contain a partition. There are portal-specific tables and some tables are shared between the gateway and the portal. Tables that are not interfacing with the gateway are frontend-specific.

### Shared Tables

- tenant table, managed by the portal
    - stores and tracks the balance
- app(lication) table, managed by the portal
- app rule table, managed by the portal
- payment ledger, updated and managed by the watcher
- relay ledger, updated by the gateway
- product table, it is a look up table
    - contains the supported chains, but generalises 
    - maps the chain name to an identifier
    - enables per product usage tracking
- rule-type table, a look up table
    - describes the available rules
    - it is used inconsequentially by the gateway

### Portal-only Tables

- user table, stores user and session information, as well as governing permissions
- org(anisation) table, currently not used, but allows for scalability in the future
- enterprise table, for future use
    - an enterprise can have many tenants and many organisation
    - organisations and tenants under an enterprise can autonomously manage balances
- user-org mapping is contained in another table