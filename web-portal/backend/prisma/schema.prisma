datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Org {
  id               String          @id @unique @default(cuid())
  users            User[]
  apps             App[]
  active           Boolean         @default(true)
  deleted          Boolean         @default(false)
  createdAt        DateTime
  updatedAt        DateTime
  billingAccount   BillingAccount?
  billingAccountId String?
}

model BillingAccount {
  id        String   @id @unique @default(cuid())
  active    Boolean  @default(true)
  org       Org      @relation(fields: [orgId], references: [id])
  orgId     String   @unique
  ledger    Ledger?
  ledgerId  String?  @unique
  deleted   Boolean  @default(false)
  createdAt DateTime
  updatedAt DateTime
}

model User {
  id        String   @id @unique @default(cuid())
  org       Org      @relation(fields: [orgId], references: [id])
  orgId     String
  apps      App[]    @relation("UserApps")
  active    Boolean  @default(true)
  deleted   Boolean  @default(false)
  createdAt DateTime
  updatedAt DateTime
}

model App {
  id        String    @id @unique @default(cuid())
  org       Org       @relation(fields: [orgId], references: [id])
  orgId     String
  user      User      @relation("UserApps", fields: [userId], references: [id])
  userId    String
  appRules  AppRule[]
  appkeys   AppKeys[]
  active    Boolean   @default(true)
  deleted   Boolean   @default(false)
  createdAt DateTime
  updatedAt DateTime
}

model AppRule {
  id        String   @id @unique @default(cuid())
  app       App      @relation(fields: [appId], references: [id])
  appId     String
  rule      Rule[]
  active    Boolean  @default(true)
  deleted   Boolean  @default(false)
  createdAt DateTime
  updatedAt DateTime
}

model Rule {
  id              String   @id @unique @default(cuid())
  name            String
  isEditable      Boolean
  isMultiple      Boolean
  validationType  String
  validationValue String
  appRule         AppRule  @relation(fields: [appRuleId], references: [id])
  appRuleId       String
  active          Boolean  @default(true)
  deleted         Boolean  @default(false)
  createdAt       DateTime
  updatedAt       DateTime
}

model AppKeys {
  id        String   @id @unique @default(cuid())
  app       App      @relation(fields: [appId], references: [id])
  appId     String
  keyValue  String
  active    Boolean  @default(true)
  deleted   Boolean  @default(false)
  createdAt DateTime
  updatedAt DateTime
}

model Ledger {
  id               String          @id @unique @default(cuid())
  billingAccount   BillingAccount  @relation(fields: [billingAccountId], references: [id])
  billingAccountId String          @unique
  amount           Float
  transactionType  TransactionType
  createdAt        DateTime
}

enum TransactionType {
  CREDIT
  DEBIT
}
